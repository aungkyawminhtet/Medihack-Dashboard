### HTS Backend API Tests
### Use VS Code REST Client extension to run these requests
### Install: https://marketplace.visualstudio.com/items?itemName=humao.rest-client

@baseUrl = http://localhost:3000
@accessToken = your_access_token_here
@refreshToken = your_refresh_token_here

###############################################
# Health Check & Basic Routes
###############################################

### Health Check
GET {{baseUrl}}/health

### API Status
GET {{baseUrl}}/api

###############################################
# Authentication - Login & Registration
###############################################

### Register New User
# @name register
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "employeecode": "N002",
  "fullname": "Jane Doe",
  "role": "nurse",
  "phone": "0812345679",
  "password": "123456"
}

### Login with Employee Code (Nurse)
# @name login
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "N001",
  "password": "123456"
}

### Login as Admin
# @name adminLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "A001",
  "password": "admin123"
}

### Login as Porter
# @name porterLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "P001",
  "password": "123456"
}

### Extract Access Tokens
@authToken = {{login.response.body.data.token}}
@refreshTokenFromLogin = {{login.response.body.data.refreshToken}}
@adminToken = {{adminLogin.response.body.data.token}}
@porterToken = {{porterLogin.response.body.data.token}}

### Get Current User Info
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{authToken}}

### Refresh Access Token
# @name refresh
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshTokenFromLogin}}"
}

### Logout
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{authToken}}

###############################################
# DASHBOARD APIs - Home Screen
###############################################

### Get Dashboard Data (Home Screen)
GET {{baseUrl}}/api/dashboard
Authorization: Bearer {{authToken}}

### Get User Statistics
GET {{baseUrl}}/api/dashboard/stats
Authorization: Bearer {{authToken}}

###############################################
# EQUIPMENT APIs - Nearby Equipment & Search
###############################################

### Get All Equipment
GET {{baseUrl}}/api/equipment
Authorization: Bearer {{authToken}}

### Get Nearby Available Equipment (Home Screen)
GET {{baseUrl}}/api/equipment/nearby
Authorization: Bearer {{authToken}}

### Get Nearby Wheelchairs Only
GET {{baseUrl}}/api/equipment/nearby?type=wheelchair
Authorization: Bearer {{authToken}}

### Get Nearby Beds Only
GET {{baseUrl}}/api/equipment/nearby?type=bed
Authorization: Bearer {{authToken}}

### Search Equipment (Search Bar)
GET {{baseUrl}}/api/equipment/search?q=wheelchair
Authorization: Bearer {{authToken}}

### Get Equipment by Type
GET {{baseUrl}}/api/equipment?type=wheelchair
Authorization: Bearer {{authToken}}

### Get Available Equipment Only
GET {{baseUrl}}/api/equipment?status=available
Authorization: Bearer {{authToken}}

### Get Equipment by ID
GET {{baseUrl}}/api/equipment/equipment-id-here
Authorization: Bearer {{authToken}}

### Get Equipment Location History
GET {{baseUrl}}/api/equipment/equipment-id-here/location-history
Authorization: Bearer {{authToken}}

### Update Equipment Status
PUT {{baseUrl}}/api/equipment/equipment-id-here/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "maintenance"
}

###############################################
# REQUESTS APIs - Active Tasks & Requests
###############################################

### Get All Requests
GET {{baseUrl}}/api/requests
Authorization: Bearer {{authToken}}

### Get Active Tasks (Home Screen - Active Tasks Section)
GET {{baseUrl}}/api/requests/active
Authorization: Bearer {{authToken}}

### Get My Requests (Requests I Created)
GET {{baseUrl}}/api/requests/my-requests
Authorization: Bearer {{authToken}}

### Get Assigned Requests (Requests Assigned to Me)
GET {{baseUrl}}/api/requests/assigned
Authorization: Bearer {{authToken}}

### Get Requests by Status
GET {{baseUrl}}/api/requests?status=pending
Authorization: Bearer {{authToken}}

### Get High Priority Requests
GET {{baseUrl}}/api/requests?priority=2
Authorization: Bearer {{authToken}}

### Get Wheelchair Requests
GET {{baseUrl}}/api/requests?equipment_type=wheelchair
Authorization: Bearer {{authToken}}

### Get Request by ID (Task Detail Screen)
GET {{baseUrl}}/api/requests/request-id-here
Authorization: Bearer {{authToken}}

### Create New Request
# @name createRequest
POST {{baseUrl}}/api/requests
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "patient_name": "John Doe",
  "priority": 1,
  "pickup_room_id": "room-id-here",
  "destination_room_id": "room-id-here",
  "equipment_type": "wheelchair",
  "notes": "Patient needs immediate transfer"
}

### Update Request Status
PUT {{baseUrl}}/api/requests/request-id-here/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "in_progress"
}

### Assign Request to Porter
PUT {{baseUrl}}/api/requests/request-id-here/assign
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "porter_id": "porter-user-id-here",
  "equipment_id": "equipment-id-here"
}

### Cancel Request
DELETE {{baseUrl}}/api/requests/request-id-here
Authorization: Bearer {{authToken}}

###############################################
# COMPLETE HOME SCREEN WORKFLOW
###############################################

### Step 1: Login as Nurse
# @name nurseLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "N001",
  "password": "123456"
}

@nurseToken = {{nurseLogin.response.body.data.token}}

### Step 2: Get Dashboard Data (Simulates Home Screen Load)
# This returns:
# - User info (Good Morning, User)
# - Nearby equipment count (12 Within 50 meters)
# - Active tasks list (Wheelchair Required, Bed Transfer Request)
GET {{baseUrl}}/api/dashboard
Authorization: Bearer {{nurseToken}}

### Step 3: Search for Wheelchair
GET {{baseUrl}}/api/equipment/search?q=wheelchair&status=available
Authorization: Bearer {{nurseToken}}

### Step 4: Get Active Tasks Details
GET {{baseUrl}}/api/requests/active
Authorization: Bearer {{nurseToken}}

###############################################
# Role-Based Testing
###############################################

### Admin: Get all users
GET {{baseUrl}}/api/users
Authorization: Bearer {{adminToken}}

### Nurse: Create request
POST {{baseUrl}}/api/requests
Authorization: Bearer {{nurseToken}}
Content-Type: application/json

{
  "patient_name": "Test Patient",
  "priority": 2,
  "pickup_room_id": "room-id",
  "destination_room_id": "room-id",
  "equipment_type": "bed",
  "notes": "High priority transfer"
}

### Porter: Get assigned tasks
GET {{baseUrl}}/api/requests/assigned
Authorization: Bearer {{porterToken}}

###############################################
# Priority Labels for Tasks
###############################################

# Priority values in UI:
# 1 = STAT (Red badge)
# 2 = HIGH (Orange badge)
# 3 = NORMAL (Blue badge)
# 4+ = LOW (Gray badge)

### Get STAT Priority Requests
GET {{baseUrl}}/api/requests?priority=1
Authorization: Bearer {{authToken}}

### Get HIGH Priority Requests
GET {{baseUrl}}/api/requests?priority=2
Authorization: Bearer {{authToken}}

### Get NORMAL Priority Requests
GET {{baseUrl}}/api/requests?priority=3
Authorization: Bearer {{authToken}}

###############################################
# MAP APIs - Equipment Map Screen
###############################################

### Get All Equipment with Locations (Map View)
GET {{baseUrl}}/api/map
Authorization: Bearer {{authToken}}

### Get Equipment on Floor 1 (Map Screen - Floor 1 Selected)
# @name mapFloor1
GET {{baseUrl}}/api/map/floor/floor-id-here
Authorization: Bearer {{authToken}}

### Get Wheelchairs Only on Current Floor
GET {{baseUrl}}/api/map?type=wheelchair
Authorization: Bearer {{authToken}}

### Get Beds Only on Current Floor
GET {{baseUrl}}/api/map?type=bed
Authorization: Bearer {{authToken}}

### Get Available Equipment Only (Green dots)
GET {{baseUrl}}/api/map?status=available
Authorization: Bearer {{authToken}}

### Get In-Use Equipment Only (Orange dots)
GET {{baseUrl}}/api/map?status=in_use
Authorization: Bearer {{authToken}}

### Get Equipment on Specific Floor - Wheelchairs
GET {{baseUrl}}/api/map?floor_id=floor-id-here&type=wheelchair
Authorization: Bearer {{authToken}}

### Search Equipment by ID or Location (Map Search Bar)
GET {{baseUrl}}/api/map/search?q=WC-001
Authorization: Bearer {{authToken}}

### Search by Room Name
GET {{baseUrl}}/api/map/search?q=ER
Authorization: Bearer {{authToken}}

### Get Equipment Count Summary
GET {{baseUrl}}/api/map/equipment-count
Authorization: Bearer {{authToken}}

### Get Equipment Count for Specific Floor
GET {{baseUrl}}/api/map/equipment-count?floor_id=floor-id-here
Authorization: Bearer {{authToken}}

### Get Current User Location (Blue User Icon on Map)
GET {{baseUrl}}/api/map/user-location
Authorization: Bearer {{authToken}}

###############################################
# FLOORS APIs - Floor Selector
###############################################

### Get All Floors (Floor Selector: 1, 2, 3)
GET {{baseUrl}}/api/floors
Authorization: Bearer {{authToken}}

### Get Floor Details with Zones and Rooms
GET {{baseUrl}}/api/floors/floor-id-here
Authorization: Bearer {{authToken}}

### Get All Equipment on Specific Floor
GET {{baseUrl}}/api/floors/floor-id-here/equipment
Authorization: Bearer {{authToken}}

### Get Wheelchairs on Specific Floor
GET {{baseUrl}}/api/floors/floor-id-here/equipment?type=wheelchair
Authorization: Bearer {{authToken}}

### Get Available Equipment on Specific Floor
GET {{baseUrl}}/api/floors/floor-id-here/equipment?status=available
Authorization: Bearer {{authToken}}

### Get All Rooms on Specific Floor
GET {{baseUrl}}/api/floors/floor-id-here/rooms
Authorization: Bearer {{authToken}}

### Get All Zones on Specific Floor
GET {{baseUrl}}/api/floors/floor-id-here/zones
Authorization: Bearer {{authToken}}

### Get Floor Statistics (Equipment counts, etc.)
GET {{baseUrl}}/api/floors/floor-id-here/stats
Authorization: Bearer {{authToken}}

###############################################
# COMPLETE MAP SCREEN WORKFLOW
###############################################

### Step 1: Login
# @name mapLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "N001",
  "password": "123456"
}

@mapToken = {{mapLogin.response.body.data.token}}

### Step 2: Get All Floors (For Floor Selector)
GET {{baseUrl}}/api/floors
Authorization: Bearer {{mapToken}}

### Step 3: Get Equipment on Floor 1 (Default)
# This simulates loading the map screen with Floor 1 selected
GET {{baseUrl}}/api/map?floor_id=floor-id-here
Authorization: Bearer {{mapToken}}

### Step 4: Filter to Show Only Wheelchairs
GET {{baseUrl}}/api/map?floor_id=floor-id-here&type=wheelchair
Authorization: Bearer {{mapToken}}

### Step 5: Search for Specific Equipment
GET {{baseUrl}}/api/map/search?q=WC-001&floor_id=floor-id-here
Authorization: Bearer {{mapToken}}

### Step 6: Get Equipment Count (For "All (5)" badge)
GET {{baseUrl}}/api/map/equipment-count?floor_id=floor-id-here
Authorization: Bearer {{mapToken}}

###############################################
# WORKLOAD APIs - Staff Performance Screen
###############################################

### Get Workload Overview Stats (Top Summary Cards)
# Returns: Total Tasks, Completed, Avg Time, Efficiency %
GET {{baseUrl}}/api/workload
Authorization: Bearer {{authToken}}

### Get All Staff with Performance Metrics
GET {{baseUrl}}/api/workload/staff
Authorization: Bearer {{authToken}}

### Filter Staff - Porters Only
GET {{baseUrl}}/api/workload/staff?role=porter
Authorization: Bearer {{authToken}}

### Filter Staff - Nurses Only
GET {{baseUrl}}/api/workload/staff?role=nurse
Authorization: Bearer {{authToken}}

### Filter Staff - Active Status Only
GET {{baseUrl}}/api/workload/staff?status=available
Authorization: Bearer {{authToken}}

### Filter Staff - Busy (On Break)
GET {{baseUrl}}/api/workload/staff?status=busy
Authorization: Bearer {{authToken}}

### Filter Staff - Offline
GET {{baseUrl}}/api/workload/staff?status=offline
Authorization: Bearer {{authToken}}

### Filter Staff - Porters + Active
GET {{baseUrl}}/api/workload/staff?role=porter&status=available
Authorization: Bearer {{authToken}}

### Get Specific Staff Member Detail
GET {{baseUrl}}/api/workload/staff/staff-id-here
Authorization: Bearer {{authToken}}

###############################################
# Notes
###############################################

# Default Test Accounts (from schema):
# - Nurse:  N001 / 123456
# - Porter: P001 / 123456
# - Admin:  A001 / admin123

# Home Screen Data:
# GET /api/dashboard - Returns all home screen data in one call
# GET /api/equipment/nearby - Returns nearby equipment count
# GET /api/requests/active - Returns active tasks list

# Search Functionality:
# GET /api/equipment/search?q=wheelchair - Search equipment
# GET /api/equipment/nearby?type=wheelchair - Filter by type
